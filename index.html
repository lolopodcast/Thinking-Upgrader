<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TU - Thinking Upgrader | BCG Professional Edition</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Merriweather:wght@300;400;700;900&family=Noto+Sans+TC:wght@300;400;500;700&family=Noto+Serif+TC:wght@400;700;900&display=swap" rel="stylesheet">

    <style>
        :root {
            --bcg-green: #173728;
            --bcg-gold: #BFA15F;
            --header-height: 4rem; /* h-16 = 64px */
            --footer-height: 2rem; /* h-8 = 32px */
        }

        body {
            font-family: 'Inter', 'Noto Sans TC', sans-serif;
            transition: background-color 0.3s, color 0.3s;
            overflow: hidden; /* Main scroll handled by inner container */
        }

        h1, h2, h3, h4, h5, h6, .brand-font {
            font-family: 'Merriweather', 'Noto Serif TC', serif;
        }

        /* 3D Flip Card */
        .perspective-1000 { perspective: 1000px; }
        .transform-style-3d { transform-style: preserve-3d; }
        .backface-hidden { backface-visibility: hidden; }
        .rotate-y-180 { transform: rotateY(180deg); }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #555; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #BFA15F; }

        /* Animations */
        @keyframes fade-in-up {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in-up {
            animation: fade-in-up 0.5s ease-out forwards;
        }

        @keyframes slide-in-right {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        .toast-enter {
            animation: slide-in-right 0.3s ease-out forwards;
        }
    </style>
    
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        bcg: {
                            green: '#173728',     // Deep Green
                            light: '#2D8A6D',     // Accent Green
                            gold: '#BFA15F',      // Gold
                            dark: '#121212',      // Dark Bg
                            card: '#1E1E1E',      // Dark Card
                            charcoal: '#2D2D2D',  // Light Mode Text
                            gray: '#F3F4F6'       // Light Mode Bg
                        }
                    },
                    height: {
                        header: '4rem',
                        footer: '2rem'
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-bcg-gray text-bcg-charcoal dark:bg-bcg-dark dark:text-gray-100 flex flex-col h-screen">
    <div id="root" class="flex-grow flex flex-col h-full overflow-hidden"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- Icons (SVG Components) ---
        const Icon = ({ path, size = 20, className = "", fill = "none" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill={fill} stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                {path}
            </svg>
        );

        const Icons = {
            Menu: (props) => <Icon {...props} path={<><line x1="4" y1="12" x2="20" y2="12"/><line x1="4" y1="6" x2="20" y2="6"/><line x1="4" y1="18" x2="20" y2="18"/></>} />,
            X: (props) => <Icon {...props} path={<><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></>} />,
            Globe: (props) => <Icon {...props} path={<><circle cx="12" cy="12" r="10"/><line x1="2" y1="12" x2="22" y2="12"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></>} />,
            Moon: (props) => <Icon {...props} path={<><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></>} />,
            Sun: (props) => <Icon {...props} path={<><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></>} />,
            Volume2: (props) => <Icon {...props} path={<><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><path d="M19.07 4.93a10 10 0 0 1 0 14.14"/><path d="M15.54 8.46a5 5 0 0 1 0 7.07"/></>} />,
            CheckCircle: (props) => <Icon {...props} path={<><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></>} />,
            XCircle: (props) => <Icon {...props} path={<><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></>} />,
            Brain: (props) => <Icon {...props} path={<><path d="M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.98-3A2.5 2.5 0 0 1 9.5 2Z"/><path d="M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 14.5 2Z"/></>} />,
            Search: (props) => <Icon {...props} path={<><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></>} />,
            GitBranch: (props) => <Icon {...props} path={<><line x1="6" y1="3" x2="6" y2="15"/><circle cx="18" cy="6" r="3"/><circle cx="6" cy="18" r="3"/><path d="M18 9a9 9 0 0 1-9 9"/></>} />,
            FlaskConical: (props) => <Icon {...props} path={<><path d="M10 2v7.527a2 2 0 0 1-.211.896L4.72 20.55a1 1 0 0 0 .9 1.45h12.76a1 1 0 0 0 .9-1.45l-5.069-10.127A2 2 0 0 1 14 9.527V2"/><line x1="8.5" y1="2" x2="15.5" y2="2"/><line x1="8.5" y1="14" x2="15.5" y2="14"/></>} />,
            Target: (props) => <Icon {...props} path={<><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></>} />,
            LayoutDashboard: (props) => <Icon {...props} path={<><rect x="3" y="3" width="7" height="7"></rect><rect x="14" y="3" width="7" height="7"></rect><rect x="14" y="14" width="7" height="7"></rect><rect x="3" y="14" width="7" height="7"></rect></>} />,
            ExternalLink: (props) => <Icon {...props} path={<><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></>} />,
            Save: (props) => <Icon {...props} path={<><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path><polyline points="17 21 17 13 7 13 7 21"></polyline><polyline points="7 3 7 8 15 8"></polyline></>} />,
            FileText: (props) => <Icon {...props} path={<><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></>} />,
            Download: (props) => <Icon {...props} path={<><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></>} />,
            Home: (props) => <Icon {...props} path={<><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></>} />,
            Video: (props) => <Icon {...props} fill="currentColor" path={<><circle cx="12" cy="12" r="10"/><polygon points="10 8 16 12 10 16 10 8" stroke="white" strokeWidth="2" fill="white"/></>} />
        };

        // --- Data Content ---
        const content = {
            en: {
                nav: {
                    intro: "Introduction",
                    ch1: "1. Observation",
                    ch2: "2. Logic",
                    ch3: "3. Research",
                    ch4: "4. Analysis",
                    ch5: "5. Hypothesis",
                    ws_ex: "Ex: TSMC Case",
                    ws_blank: "Worksheet (Blank)",
                    dashboard: "Dashboard"
                },
                brand: "TU - Thinking Upgrader",
                subtitle: "5 Secrets to Observation, Analysis, and Argumentation",
                intro: {
                    title: "Thinking Upgrader",
                    subtitle: "Upgrade from 'Seeing' to 'Thinking'",
                    desc: "A systematic training guide for students to master critical thinking. We guide you through 5 key steps: from basic observation to logical deduction, analysis, and constructing hypothesis with evidence.",
                    mapTitle: "5-Step Thinking Map",
                    steps: [
                        {id: 1, text: "Observation: Distinguish Facts from Opinions", target: "ch1"},
                        {id: 2, text: "Logic: Abduction, Induction, Deduction", target: "ch2"},
                        {id: 3, text: "Research: Quantitative vs. Qualitative", target: "ch3"},
                        {id: 4, text: "Analysis: Separate, Diagnose, Integrate", target: "ch4"},
                        {id: 5, text: "Hypothesis: Variable Modeling & Verification", target: "ch5"}
                    ],
                    videoTitle: "Recommended Learning Resources",
                    videos: [
                        {title: "Ep.32 Essence: Secrets of Observation & Analysis (7 min)", url: "https://youtu.be/PH4WWPA6lhk"},
                        {title: "Ep.32a Full Lecture: Deep Dive into Critical Thinking (34 min)", url: "https://youtu.be/p-CNjDzMO8I"}
                    ]
                },
                chapters: [
                    {
                        id: "ch1", title: "Ch1: Observation", subtitle: "Separate Facts from Opinions", icon: Icons.Target,
                        coreConcept: "The foundation of critical thinking is the rigorous distinction between 'Facts' and 'Opinions'. Facts are objective data captured by our senses (like a camera recording or a thermometer reading). Opinions are the brain's subjective, emotional interpretations of that data. To observe effectively, we must 'remove our filters' and use structured tools like ORID (Objective, Reflective, Interpretive, Decisional) to layer our thinking process. This prevents bias from clouding our judgment before analysis begins. True observation requires seeing the context without jumping to conclusions.",
                        glossary: [
                            {term: "Fact", def: "Objective reality. Observable, measurable data that can be verified by others (e.g., 'Revenue dropped 5%')."},
                            {term: "Opinion", def: "Subjective interpretation. Personal feelings, judgments, or adjectives applied to facts (e.g., 'Business is terrible')."},
                            {term: "ORID", def: "A focused conversation method guiding thinking from Data (Objective) to Reaction (Reflective), Meaning (Interpretive), and Action (Decisional)."},
                            {term: "3W1H", def: "A comprehensive scanning tool: What (Objects/Events), Why (Reasons), Context (Who/When/Where), and How (Mechanism)."}
                        ],
                        caseStudy: {
                            title: "Case: The Coffee War",
                            desc: "An untrained observer says: 'This coffee tastes bad, the staff is grumpy, no wonder no one buys it.' This mixes subjective feelings with assumptions. A trained observer records: 'Between 8:00-9:00 AM, 50 people entered, but only 3 bought coffee. Customers checked their watches frequently while waiting.' The Finding: The issue might be process efficiency (speed), not product quality (taste).",
                            quiz: [
                                { q: "Which of the following statements represents a FACT?", opts: ["The clerk looks very lazy today.", "The coffee machine takes exactly 3 minutes to brew one cup.", "Customers seem annoyed by the long wait.", "This store has a terrible atmosphere."], ans: 1, exp: "A fact must be measurable or observable data. '3 minutes' is a specific measurement. Lazy, annoyed, and terrible are subjective interpretations." },
                                { q: "In the ORID framework, 'I feel frustrated waiting' belongs to which level?", opts: ["Objective", "Reflective", "Interpretive", "Decisional"], ans: 1, exp: "Reflective deals with emotional responses and feelings." }
                            ]
                        }
                    },
                    {
                        id: "ch2", title: "Ch2: Logic", subtitle: "Connecting Phenomena with Causes", icon: Icons.GitBranch,
                        coreConcept: "Logic bridges our internal understanding (Epistemology) with the external world (Ontology). It isn't just about 'making sense'; it's about correctly linking Causes, Rules, and Results. We utilize three distinct logic engines: Abduction (the detective's tool to guess causes from results), Induction (the scientist's tool to find patterns from cases), and Deduction (the strategist's tool to predict results from rules). Mastery involves knowing which engine to use at which stage of your inquiry.",
                        glossary: [
                            {term: "Abduction", def: "Inference to the best explanation. Guessing the most likely cause from an observed result. (Result + Rule â†’ Cause)"},
                            {term: "Induction", def: "Generalization. Deriving a general rule from specific repeated observations. (Case A + Case B â†’ Rule)"},
                            {term: "Deduction", def: "Prediction. Deriving a specific necessary conclusion from a general rule. (Rule + Cause â†’ Result)"},
                            {term: "Epistemology", def: "The theory of knowledge. How our brains process information and justify belief."}
                        ],
                        caseStudy: {
                            title: "Case: Smartphone Sales Drop",
                            desc: "Scenario: Sales dropped 40% (Result). 1. Abduction (Guessing): Marketing suggests 'Price is too high'. 2. Induction (Pattern Finding): Analysis of 5 years of data shows 'Phones over $1000 without trade-in deals always fail'. 3. Deduction (Prediction): 'If we launch a trade-in program (Cause) + Rule, sales will recover (Result)'.",
                            quiz: [
                                { q: "You see the ground is wet (Result) and know 'Rain makes ground wet' (Rule). You guess 'It rained' (Cause). What logic is this?", opts: ["Deduction", "Induction", "Abduction", "Reduction"], ans: 2, exp: "Abduction is reasoning backward from an effect (wet ground) to a probable cause (rain). It is probabilistic." },
                                { q: "All men are mortal. Socrates is a man. Therefore, Socrates is mortal. This is:", opts: ["Abduction", "Induction", "Deduction", "Observation"], ans: 2, exp: "Deduction applies a general rule to a specific case to get a certain result." }
                            ]
                        }
                    },
                    {
                        id: "ch3", title: "Ch3: Research", subtitle: "Choosing the Right Method", icon: Icons.Search,
                        coreConcept: "Research is literally 'Re-searching'â€”the iterative process of seeking truth to resolve curiosity or confusion. There is no single 'best' method; there is only the right tool for the job. Quantitative research acts like a ruler, measuring the world (height, weight, causality) for generalization. Qualitative research acts like a novel, interpreting the world (context, pain points) to make invisible meanings visible, like understanding the suffering of the 'Little Match Girl' rather than just counting her matches.",
                        glossary: [
                            {term: "Re-search", def: "The systematic, iterative process of investigating a problem to construct new knowledge."},
                            {term: "Quantitative", def: "Focuses on numbers, measurement, statistics, and causal strength. Used to verify hypotheses."},
                            {term: "Qualitative", def: "Focuses on words, meaning, context, and interpretation. Used to explore new phenomena."},
                            {term: "Context", def: "The specific circumstances (Who, When, Where, Cultural background) that give meaning to an event."}
                        ],
                        caseStudy: {
                            title: "Case: Netflix Strategy",
                            desc: "Netflix uses Quantitative Big Data to know exactly *when* you pause a movie or abandon a series. However, numbers can't tell them *why*. They must use Qualitative Focus Groups to understand that viewers disconnected because a character lacked emotional depth. A complete strategy requires both: Numbers for the 'What', Stories for the 'Why'.",
                            quiz: [
                                { q: "If you want to understand 'Why users feel frustrated' deeply, which method is best?", opts: ["Quantitative Survey", "Qualitative Interview", "Deduction", "Abduction"], ans: 1, exp: "Qualitative research excels at exploring 'Why' questions and revealing specific user context." },
                                { q: "Which method is best for testing if 'A causes B' across a large population?", opts: ["Quantitative", "Qualitative", "Observation", "None"], ans: 0, exp: "Quantitative uses statistics to measure causal strength and generalize results." }
                            ]
                        }
                    },
                    {
                        id: "ch4", title: "Ch4: Analysis", subtitle: "Dialectics for Insight", icon: Icons.Brain,
                        coreConcept: "Analysis is the art of breaking things down (Separate), examining relationships (Diagnose), and rebuilding them (Integrate). True insight doesn't come from echoing one side; it comes from resolving contradictions. We use Dialectic Logic: identifying a Thesis (status quo) and an Anti-thesis (opposing force), then merging them into a Synthesis. This Synthesis is not a compromise; it is a superior, higher-level solution that transcends the original conflict.",
                        glossary: [
                            {term: "Thesis (æ­£)", def: "The proposition. The mainstream view, current established practice, or the initial argument."},
                            {term: "Anti-thesis (å)", def: "The negation. The opposing view, the contradiction, or the limitations of the thesis."},
                            {term: "Synthesis (åˆ)", def: "The resolution. A new, higher-level insight that resolves the conflict between thesis and anti-thesis."},
                            {term: "Separate", def: "Deconstructing complex phenomena into smaller, manageable components for examination."}
                        ],
                        caseStudy: {
                            title: "Case: Toyota EV Strategy",
                            desc: "Thesis: 'We must go 100% Electric (BEV) immediately for a green future.' Anti-thesis: 'Infrastructure is lacking globally, and electricity sources aren't always clean.' Synthesis: 'Multi-pathway Strategy.' The enemy is carbon, not the internal combustion engine. We will use Hybrids, Hydrogen, and EVs together to adapt to different market realities and reduce carbon most effectively.",
                            quiz: [
                                { q: "In Dialectic Logic (Hegel), what is 'Synthesis'?", opts: ["Average", "Winner", "Higher-level resolution", "Ignoring problem"], ans: 2, exp: "Synthesis creates a third way that preserves the truth of both sides while overcoming their limitations." },
                                { q: "What is the first step of Analysis?", opts: ["Integrate", "Diagnose", "Separate", "Guess"], ans: 2, exp: "Analysis starts with Separating (breaking down) the problem." }
                            ]
                        }
                    },
                    {
                        id: "ch5", title: "Chapter 5: Hypothesis",
                        subtitle: "Model Building & Verification",
                        icon: Icons.FlaskConical,
                        coreConcept: "To prove an argument, we must translate vague ideas into precise models. We use 'Variable Building Blocks' to construct a causal story. X (Cause) leads to Y (Effect). But how? Through Me (Mediator - the path). And when? Depending on Mo (Moderator - the condition). A strong hypothesis defines these variables, allowing verification through statistical data (Quantitative) or rigorous logic (Qualitative).",
                        glossary: [
                            {term: "X (Cause)", def: "The independent variable. The factor that drives or influences the outcome."},
                            {term: "Y (Effect)", def: "The dependent variable. The outcome or phenomenon we are trying to explain."},
                            {term: "Me (Mediator)", def: "The mechanism. The 'Why'. X affects Y *through* Me. (e.g., Fire -> Heat -> Burn)."},
                            {term: "Mo (Moderator)", def: "The condition. The 'When'. It strengthens or weakens the X-Y relationship."}
                        ],
                        caseStudy: {
                            title: "Case: Influencer Marketing",
                            desc: "Hypothesis: Influencers (X) increase Product Sales (Y). But why? Because they build Trust (Me). However, this effect isn't constant. If Product Price is too high (Mo), the influencer's power decreases. Model: X -> Me -> Y, moderated by Mo.",
                            quiz: [
                                { q: "In the model 'Influencer -> Trust -> Sales', what type of variable is 'Trust'?", opts: ["X", "Y", "Mo", "Me"], ans: 3, exp: "Trust is the *pathway* or *mechanism* through which the Influencer affects Sales." },
                                { q: "If 'Price' changes the strength of the relationship between Influencer and Sales, what is 'Price'?", opts: ["X", "Y", "Mo", "Me"], ans: 2, exp: "A Moderator (Mo) changes the strength or direction of a relationship." }
                            ]
                        }
                    }
                ],
                worksheets: {
                    exTitle: "Example: TSMC Arizona Case",
                    blankTitle: "Worksheet (Blank)",
                    s1: "1. Observation Lab (ORID/4F)",
                    s2: "2. Logic & Insight Canvas",
                    s3: "3. Research Blueprint (Model)",
                    save: "Save Progress",
                    saved: "Saved successfully to local storage!",
                    labels: { o: "Objective / Fact", r: "Reflective / Feeling", i: "Interpretive / Finding", d: "Decisional / Future", logic: "Logic Engines", thesis: "Thesis", anti: "Anti-thesis", synth: "Synthesis", model: "Variables (X, Y, Me, Mo)", verify: "Verification Plan" }
                },
                dashboard: {
                    title: "Learning Dashboard",
                    progress: "Overall Progress",
                    badges: "Badges",
                    history: "Quiz History",
                    badgeList: ["Observer", "Logician", "Researcher", "Analyst", "Scientist"],
                    score: "Score",
                    export: "Export Data (CSV)"
                },
                ui: {
                    tryAgain: "Try Again",
                    correct: "Correct!",
                    incorrect: "Incorrect.",
                    flipTip: "(Click to flip, Click away to reset)",
                    footerLeft: `v3.4 | ${new Date().toISOString().split('T')[0]} | Â© Thinking Upgrader`,
                    footerRight: "Instructor: Prof. Shihmin Lo"
                }
            },
            zh: {
                nav: {
                    intro: "ç°¡ä»‹",
                    ch1: "1. è§€å¯Ÿ",
                    ch2: "2. é‚è¼¯",
                    ch3: "3. æŽ¢ç©¶",
                    ch4: "4. åˆ†æž",
                    ch5: "5. å¯¦è­‰",
                    ws_ex: "ç¯„ä¾‹ï¼šå°ç©é›»",
                    ws_blank: "ç©ºç™½å­¸ç¿’å–®",
                    dashboard: "å­¸ç¿’æ­·ç¨‹"
                },
                brand: "TU - Thinking Upgrader",
                subtitle: "è§€å¯Ÿåˆ†æžèˆ‡è«–è­‰äº”å¤§ç¥•è¨£",
                intro: {
                    title: "æ€ç¶­å‡ç´šè¨ˆç•«",
                    subtitle: "å¾žã€Œæœƒçœ‹ã€åˆ°ã€Œæœƒæƒ³ã€çš„æ€è€ƒå‡ç´šæˆ°",
                    desc: "é€™æ˜¯ä¸€å¥—ç‚ºå¤§å­¸ç”Ÿè¨­è¨ˆçš„ç³»çµ±åŒ–è¨“ç·´ã€‚æˆ‘å€‘å°‡é€éŽäº”å€‹æ­¥é©Ÿï¼Œå¾žæœ€åŸºç¤Žçš„æ˜Žè¾¨äº‹å¯¦ï¼Œåˆ°é‚è¼¯æŽ¨æ¼”ã€æ·±åº¦åˆ†æžï¼Œæœ€å¾Œå»ºæ§‹å‡ºå‡èªªèˆ‡å¯¦è­‰ã€‚",
                    mapTitle: "äº”æ­¥é©Ÿæ€ç¶­åœ°åœ– (é»žæ“Šå‰å¾€)",
                    steps: [
                        {id: 1, text: "è§€å¯Ÿ (Observation)ï¼šå€åˆ†äº‹å¯¦èˆ‡è§€é»ž", target: "ch1"},
                        {id: 2, text: "é‚è¼¯ (Logic)ï¼šæº¯å› ã€æ­¸ç´ã€æ¼”ç¹¹", target: "ch2"},
                        {id: 3, text: "æŽ¢ç©¶ (Research)ï¼šé‡åŒ– vs. è³ªæ€§", target: "ch3"},
                        {id: 4, text: "åˆ†æž (Analysis)ï¼šæ‹†è§£ã€è¨ºæ–·ã€æ•´åˆ", target: "ch4"},
                        {id: 5, text: "å¯¦è­‰ (Hypothesis)ï¼šè®Šæ•¸æ¨¡åž‹èˆ‡é©—è­‰", target: "ch5"}
                    ],
                    videoTitle: "æŽ¨è–¦å­¸ç¿’è³‡æº (Recommended Resources)",
                    videos: [
                        {title: "Ep.32 ç²¾è¯ç‰ˆï¼šè§€å¯Ÿã€åˆ†æžèˆ‡è«–è­‰çš„ç¥•è¨£ (7 min)", url: "https://youtu.be/PH4WWPA6lhk"},
                        {title: "Ep.32a å®Œæ•´ç‰ˆï¼šè§€å¯Ÿã€åˆ†æžèˆ‡è«–è­‰çš„ç¥•è¨£ (34 min)", url: "https://youtu.be/p-CNjDzMO8I"}
                    ]
                },
                chapters: [
                    {
                        id: "ch1", title: "ç¬¬ä¸€ç« ï¼šè§€å¯Ÿ", subtitle: "æ‹†åˆ†äº‹å¯¦èˆ‡è§€é»ž", icon: Icons.Target,
                        coreConcept: "æ‰¹åˆ¤æ€§æ€è€ƒçš„åŸºçŸ³åœ¨æ–¼åš´æ ¼å€åˆ†å®¢è§€çš„ã€Œäº‹å¯¦ã€èˆ‡ä¸»è§€çš„ã€Œè§€é»žã€ã€‚äº‹å¯¦æ˜¯æ„Ÿå®˜æŽ¥æ”¶åˆ°çš„åŽŸå§‹æ•¸æ“šï¼ˆå¦‚æ”å½±æ©Ÿç•«é¢ï¼‰ï¼›è§€é»žæ˜¯å¤§è…¦çš„æƒ…ç·’è§£è®€ã€‚ç‚ºäº†æœ‰æ•ˆè§€å¯Ÿï¼Œå¿…é ˆã€Œæ‹¿æŽ‰æ¿¾é¡ã€ï¼Œä¸¦ä½¿ç”¨ ORIDï¼ˆå®¢è§€ã€åæ‡‰ã€è©®é‡‹ã€æ±ºå®šï¼‰å°‡æ€è€ƒåˆ†å±¤ï¼Œé¿å…åè¦‹ã€‚çœŸæ­£çš„è§€å¯Ÿéœ€è¦çœ‹è¦‹äº‹ç‰©çš„æœ¬è³ªèˆ‡è„ˆçµ¡ï¼Œè€Œä¸åƒ…åƒ…æ˜¯è¡¨è±¡ã€‚",
                        glossary: [
                            {term: "Fact (äº‹å¯¦)", def: "å®¢è§€ç¾å¯¦ã€‚å¯æ¸¬é‡ã€é©—è­‰çš„æ•¸æ“šï¼ˆä¾‹ï¼šç‡Ÿæ”¶ä¸‹é™5%ï¼‰ã€‚"},
                            {term: "Opinion (è§€é»ž)", def: "ä¸»è§€è§£è®€ã€‚æ„Ÿå—æˆ–åˆ¤æ–·ï¼ˆä¾‹ï¼šç”Ÿæ„å¾ˆå·®ï¼‰ã€‚"},
                            {term: "ORID", def: "ç„¦é»žè¨Žè«–æ³•ã€‚å¾žæ•¸æ“šåˆ°è¡Œå‹•çš„æ€è€ƒå¼•å°Žæ¡†æž¶ã€‚"},
                            {term: "3W1H", def: "æŽƒæå·¥å…·ï¼šWhat, Why, Context, Howã€‚"}
                        ],
                        caseStudy: {
                            title: "å€‹æ¡ˆï¼šå’–å•¡æˆ°",
                            desc: "éŒ¯èª¤ï¼šå’–å•¡é›£å–ï¼ˆè§€é»žï¼‰ã€‚æ­£ç¢ºï¼š8-9é»žé€²åº—50äººåƒ…3äººè²·ï¼Œé¡§å®¢çœ‹æ‰‹éŒ¶ï¼ˆäº‹å¯¦ï¼‰ã€‚æ´žå¯Ÿï¼šå•é¡Œæ˜¯é€Ÿåº¦éžå£å‘³ã€‚",
                            quiz: [
                                { q: "ä½•è€…ç‚ºäº‹å¯¦ï¼Ÿ", opts: ["åº—å“¡æ‡¶æƒ°", "è£½ä½œéœ€3åˆ†é˜", "é¡§å®¢åŽ­ç…©", "æ°£æ°›å·®"], ans: 1, exp: "ã€Œ3åˆ†é˜ã€æ˜¯å¯æ¸¬é‡æ•¸æ“šã€‚" },
                                { q: "åœ¨ ORID ä¸­ï¼Œã€Œæˆ‘è¦ºå¾—å¾ˆç„¦æ…®ã€å±¬æ–¼ï¼Ÿ", opts: ["å®¢è§€ (Objective)", "åæ‡‰ (Reflective)", "è©®é‡‹ (Interpretive)", "æ±ºå®š (Decisional)"], ans: 1, exp: "åæ‡‰å±¤æ¬¡è™•ç†æƒ…ç·’èˆ‡æ„Ÿè¦ºã€‚" }
                            ]
                        }
                    },
                    {
                        id: "ch2", title: "ç¬¬äºŒç« ï¼šé‚è¼¯", subtitle: "é€£çµå‰å› å¾Œæžœ", icon: Icons.GitBranch,
                        coreConcept: "é‚è¼¯æ˜¯é€£çµèªçŸ¥ï¼ˆçŸ¥è­˜è«–ï¼‰èˆ‡ä¸–ç•Œï¼ˆæœ¬é«”è«–ï¼‰çš„æ©‹æ¨‘ã€‚å®ƒä¸åƒ…æ˜¯æŽ¨è«–ï¼Œæ›´æ˜¯æ­£ç¢ºä¸²è¯ã€Œå› ã€è¦å‰‡ã€æžœã€çš„éŽç¨‹ã€‚ä¸‰å¤§å¼•æ“Žï¼šæº¯å› ï¼ˆæ‰¾åŽŸå› -åµæŽ¢ï¼‰ã€æ­¸ç´ï¼ˆæ‰¾è¦å¾‹-ç§‘å­¸å®¶ï¼‰ã€æ¼”ç¹¹ï¼ˆåšé æ¸¬-ç­–ç•¥å®¶ï¼‰ã€‚ç²¾é€šé‚è¼¯å³æ˜¯çŸ¥é“ä½•æ™‚ç”¨å“ªç¨®å¼•æ“Žã€‚",
                        glossary: [
                            {term: "Abduction (æº¯å› )", def: "å¾žçµæžœæŽ¨æ¸¬åŽŸå› ã€‚ï¼ˆæžœ+è¦å‰‡->å› ï¼‰"},
                            {term: "Induction (æ­¸ç´)", def: "å¾žæ¡ˆä¾‹æ‰¾è¦å¾‹ã€‚ï¼ˆæ¡ˆä¾‹A+B->è¦å‰‡ï¼‰"},
                            {term: "Deduction (æ¼”ç¹¹)", def: "å¾žè¦å‰‡é æ¸¬çµæžœã€‚ï¼ˆè¦å‰‡+å› ->æžœï¼‰"},
                            {term: "Epistemology (çŸ¥è­˜è«–)", def: "ç ”ç©¶æˆ‘å€‘ã€Œå¦‚ä½•çŸ¥é“ã€çš„å­¸å•ã€‚"}
                        ],
                        caseStudy: {
                            title: "å€‹æ¡ˆï¼šæ‰‹æ©Ÿæ»¯éŠ·",
                            desc: "éŠ·é‡è·Œï¼ˆæžœï¼‰ã€‚æº¯å› ï¼šå®šåƒ¹å¤ªé«˜ï¼Ÿæ­¸ç´ï¼šæ•¸æ“šé¡¯ç¤ºé«˜åƒ¹ç„¡å„ªæƒ å¿…æ•—ã€‚æ¼”ç¹¹ï¼šæŽ¨å‡ºå„ªæƒ å‰‡éŠ·é‡å›žå‡ã€‚",
                            quiz: [
                                { q: "åœ°æ¿•ï¼ˆæžœï¼‰+ä¸‹é›¨åœ°æ¿•ï¼ˆè¦å‰‡ï¼‰-> ä¸‹é›¨äº†ï¼ˆå› ï¼‰ã€‚æ˜¯å“ªç¨®é‚è¼¯ï¼Ÿ", opts: ["æ¼”ç¹¹", "æ­¸ç´", "æº¯å› ", "ç°¡åŒ–"], ans: 2, exp: "æº¯å› æ˜¯å¾žçµæžœå›žæŽ¨åŽŸå› ã€‚" },
                                { q: "äººçš†æœƒæ­»ã€‚è˜‡æ ¼æ‹‰åº•æ˜¯äººã€‚è˜‡æ ¼æ‹‰åº•æœƒæ­»ã€‚æ˜¯å“ªç¨®é‚è¼¯ï¼Ÿ", opts: ["æ¼”ç¹¹", "æ­¸ç´", "æº¯å› ", "ç°¡åŒ–"], ans: 0, exp: "æ¼”ç¹¹æ˜¯å¾žæ™®éè¦å‰‡æŽ¨å°Žå¿…ç„¶çµæžœã€‚" }
                            ]
                        }
                    },
                    {
                        id: "ch3", title: "ç¬¬ä¸‰ç« ï¼šæŽ¢ç©¶", subtitle: "é¸æ“‡ç ”ç©¶æ–¹æ³•", icon: Icons.Search,
                        coreConcept: "ç ”ç©¶æ˜¯ã€Œåè¦†å°‹æ‰¾ (Re-search)ã€çœŸç›¸ã€‚æ–¹æ³•æ²’æœ‰å„ªåŠ£ï¼Œåªæœ‰é©ä¸é©åˆã€‚é‡åŒ–ç ”ç©¶åƒå°ºï¼Œæ¸¬é‡ä¸–ç•Œï¼ˆèº«é«˜ã€é«”é‡ã€å› æžœå¼·åº¦ï¼‰ä»¥æ±‚ä¸€èˆ¬åŒ–ï¼›è³ªæ€§ç ”ç©¶åƒå°èªªï¼Œè©®é‡‹ä¸–ç•Œï¼ˆè„ˆçµ¡ã€ç—›é»žï¼‰ï¼Œè®“çœ‹ä¸è¦‹çš„æ„ç¾©è¢«çœ‹è¦‹ï¼ˆå¦‚è³£ç«æŸ´å°å¥³å­©çš„ç—›è‹¦ï¼‰ã€‚",
                        glossary: [
                            {term: "Re-search", def: "åè¦†æŽ¢ç´¢çœŸç›¸çš„éŽç¨‹ã€‚"},
                            {term: "Quantitative (é‡åŒ–)", def: "æ•¸å­—ã€æ¸¬é‡ã€ä¸€èˆ¬åŒ–ã€‚"},
                            {term: "Qualitative (è³ªæ€§)", def: "è„ˆçµ¡ã€è©®é‡‹ã€æ„ç¾©ã€‚"},
                            {term: "Context (è„ˆçµ¡)", def: "è³¦äºˆæ•¸æ“šæ„ç¾©çš„æƒ…å¢ƒã€‚"}
                        ],
                        caseStudy: {
                            title: "å€‹æ¡ˆï¼šNetflix",
                            desc: "é‡åŒ–çŸ¥é“ä½ åœ¨ä½•æ™‚æ£„åŠ‡ï¼›è³ªæ€§è¨ªè«‡æ‰çŸ¥é“ã€Œç‚ºä»€éº¼ã€ï¼ˆç¼ºä¹æƒ…æ„Ÿé€£çµï¼‰ã€‚å…©è€…çš†å¿…è¦ã€‚",
                            quiz: [
                                { q: "æƒ³äº†è§£ã€Œä½¿ç”¨è€…ç‚ºä½•æ„Ÿåˆ°æŒ«æŠ˜ã€ï¼Œç”¨ä»€éº¼ï¼Ÿ", opts: ["é‡åŒ–å•å·", "è³ªæ€§è¨ªè«‡", "æ¼”ç¹¹æ³•", "æº¯å› æ³•"], ans: 1, exp: "è³ªæ€§æ“…é•·æŽ¢ç´¢ã€Œç‚ºä»€éº¼ã€èˆ‡æ·±å±¤æƒ…æ„Ÿã€‚" },
                                { q: "æƒ³çŸ¥é“ã€ŒA å° B çš„å½±éŸ¿æœ‰å¤šå¤§ã€ï¼Œç”¨ä»€éº¼ï¼Ÿ", opts: ["é‡åŒ–ç ”ç©¶", "è³ªæ€§ç ”ç©¶", "è§€å¯Ÿæ³•", "ç„¡"], ans: 0, exp: "é‡åŒ–ç ”ç©¶æ“…é•·æ¸¬é‡å› æžœå¼·åº¦èˆ‡ä¸€èˆ¬åŒ–ã€‚" }
                            ]
                        }
                    },
                    {
                        id: "ch4", title: "ç¬¬å››ç« ï¼šåˆ†æž", subtitle: "è¾¯è­‰ç”¢å‡ºæ´žè¦‹", icon: Icons.Brain,
                        coreConcept: "åˆ†æž = æ‹†è§£ + è¨ºæ–· + æ•´åˆã€‚æ´žè¦‹ä¾†è‡ªçŸ›ç›¾ã€‚ä½¿ç”¨è¾¯è­‰é‚è¼¯ï¼šæ­£ï¼ˆä¸»æµï¼‰vs åï¼ˆå°ç«‹ï¼‰-> åˆï¼ˆç¶œåˆï¼‰ã€‚ã€Œåˆã€ä¸æ˜¯å¦¥å”ï¼Œè€Œæ˜¯è§£æ±ºçŸ›ç›¾çš„æ›´é«˜å±¤æ¬¡è§£æ–¹ã€‚çœŸæ­£çš„åˆ†æžå¸«ä¸é¸é‚Šç«™ï¼Œè€Œæ˜¯å°‹æ‰¾ç¬¬ä¸‰æ¢è·¯ã€‚",
                        glossary: [
                            {term: "Thesis (æ­£)", def: "å‘½é¡Œã€‚ä¸»æµè§€é»žæˆ–ç¾ç‹€ã€‚"},
                            {term: "Anti-thesis (å)", def: "åå‘½é¡Œã€‚å°ç«‹è§€é»žæˆ–ç¼ºé™·ã€‚"},
                            {term: "Synthesis (åˆ)", def: "ç¶œåˆå‘½é¡Œã€‚æ›´é«˜å±¤æ¬¡çš„æ–°è§£æ–¹ã€‚"},
                            {term: "Separate (æ‹†è§£)", def: "å°‡è¤‡é›œç¾è±¡æ‹†è§£ç‚ºå…ƒä»¶ã€‚"}
                        ],
                        caseStudy: {
                            title: "å€‹æ¡ˆï¼šToyota é›»å‹•è»Š",
                            desc: "æ­£ï¼šå…¨é¢ç´”é›»ã€‚åï¼šç¼ºé›»ç¼ºåŸºå»ºã€‚åˆï¼šå¤šå…ƒè·¯å¾‘ï¼ˆæ²¹é›»/æ°«èƒ½/ç´”é›»ï¼‰ã€‚æ•µäººæ˜¯ç¢³ä¸æ˜¯å¼•æ“Žã€‚",
                            quiz: [
                                { q: "è¾¯è­‰é‚è¼¯ä¸­çš„ã€Œåˆã€æ˜¯ä»€éº¼ï¼Ÿ", opts: ["å¹³å‡å€¼", "é¸è´å®¶", "è§£æ±ºçŸ›ç›¾çš„æ–°è§€é»ž", "å¿½ç•¥å•é¡Œ"], ans: 2, exp: "åˆæ˜¯æ•´åˆé›™æ–¹çœŸç†çš„é€²åŒ–è§€é»žã€‚" },
                                { q: "åˆ†æžçš„ç¬¬ä¸€æ­¥æ˜¯ä»€éº¼ï¼Ÿ", opts: ["æ•´åˆ", "è¨ºæ–·", "æ‹†è§£", "çŒœæ¸¬"], ans: 2, exp: "åˆ†æž (Analyze) å§‹æ–¼æ‹†è§£ (Separate)ã€‚" }
                            ]
                        }
                    },
                    {
                        id: "ch5", title: "ç¬¬äº”ç« ï¼šå¯¦è­‰", subtitle: "æ¨¡åž‹èˆ‡é©—è­‰", icon: Icons.FlaskConical,
                        coreConcept: "ç”¨ã€Œè®Šæ•¸ç©æœ¨ã€å»ºç«‹æ¨¡åž‹ï¼šXï¼ˆå› ï¼‰å°Žè‡´ Yï¼ˆæžœï¼‰ã€‚è·¯å¾‘æ˜¯ Meï¼ˆä¸­ä»‹ï¼‰ã€‚æ¢ä»¶æ˜¯ Moï¼ˆå¹²æ“¾ï¼‰ã€‚é€éŽæ•¸æ“šï¼ˆé‡åŒ–ï¼‰æˆ–é‚è¼¯çœŸå¯¦åº¦ï¼ˆè³ªæ€§ï¼‰ä¾†é©—è­‰ã€‚å¼·å¤§çš„è«–è­‰å¿…é ˆå»ºç«‹åœ¨æ¸…æ™°çš„è®Šæ•¸é—œä¿‚ä¹‹ä¸Šã€‚",
                        glossary: [
                            {term: "X (å› )", def: "è§£é‡‹è®Šæ•¸ã€‚"},
                            {term: "Y (æžœ)", def: "è¢«è§£é‡‹è®Šæ•¸ã€‚"},
                            {term: "Me (ä¸­ä»‹è®Šæ•¸)", def: "éŽç¨‹/è·¯å¾‘ (Why)ã€‚"},
                            {term: "Mo (å¹²æ“¾è®Šæ•¸)", def: "æ¢ä»¶/æƒ…å¢ƒ (When)ã€‚"}
                        ],
                        caseStudy: {
                            title: "å€‹æ¡ˆï¼šç¶²ç´…è¡ŒéŠ·",
                            desc: "ç¶²ç´… (X) -> ä¿¡ä»» (Me) -> éŠ·é‡ (Y)ã€‚è‹¥åƒ¹æ ¼é«˜ (Mo) å‰‡ç„¡æ•ˆã€‚",
                            quiz: [
                                { q: "ç¶²ç´… -> ä¿¡ä»» -> éŠ·é‡ã€‚ä¿¡ä»»æ˜¯ä»€éº¼ï¼Ÿ", opts: ["X", "Y", "Mo", "Me"], ans: 3, exp: "ä¿¡ä»»æ˜¯å½±éŸ¿å‚³éžçš„è·¯å¾‘ï¼Œå³ä¸­ä»‹è®Šæ•¸ã€‚" },
                                { q: "è‹¥ã€Œåƒ¹æ ¼ã€æœƒæ”¹è®Šç¶²ç´…å°éŠ·é‡çš„å½±éŸ¿åŠ›ï¼Œåƒ¹æ ¼æ˜¯ä»€éº¼ï¼Ÿ", opts: ["X", "Y", "Mo", "Me"], ans: 2, exp: "å¹²æ“¾è®Šæ•¸ (Mo) æœƒæ”¹è®Šå› æžœé—œä¿‚çš„å¼·å¼±ã€‚" }
                            ]
                        }
                    }
                ],
                worksheets: {
                    exTitle: "ç¯„ä¾‹ï¼šå°ç©é›»ç¾Žåœ‹å» å€‹æ¡ˆ",
                    blankTitle: "è‡ªä¸»å­¸ç¿’å–® (ç©ºç™½)",
                    s1: "1. è§€å¯ŸåŠ›å¯¦é©—å®¤ (ORID/4F)",
                    s2: "2. é‚è¼¯èˆ‡æ´žå¯Ÿç•«å¸ƒ",
                    s3: "3. ç ”ç©¶æž¶æ§‹è¨­è¨ˆ (X-Yæ¨¡åž‹)",
                    save: "æš«å­˜é€²åº¦",
                    saved: "å·²å„²å­˜ï¼",
                    labels: { o: "Objective / äº‹å¯¦", r: "Reflective / æ„Ÿå—", i: "Interpretive / ç™¼ç¾", d: "Decisional / æœªä¾†", logic: "é‚è¼¯æŽ¨æ¼”", thesis: "æ­£æ–¹è§€é»ž", anti: "åæ–¹è§€é»ž", synth: "ç¶œåˆæ´žå¯Ÿ", model: "è®Šæ•¸æ¨¡åž‹ (X, Y, Me, Mo)", verify: "é©—è­‰è¨ˆç•«" }
                },
                dashboard: {
                    title: "å­¸ç¿’æ­·ç¨‹å„€è¡¨æ¿",
                    progress: "æ•´é«”å®Œæˆåº¦",
                    badges: "æˆå°±å¾½ç« ",
                    history: "æ¸¬é©—ç´€éŒ„",
                    badgeList: ["è§€å¯Ÿæ–°æ‰‹", "é‚è¼¯åµæŽ¢", "æŽ¢ç©¶è€…", "åˆ†æžå¸«", "ç§‘å­¸å®¶"],
                    score: "å¾—åˆ†",
                    export: "åŒ¯å‡ºå­¸ç¿’ç´€éŒ„ (CSV)"
                },
                ui: {
                    tryAgain: "å†è©¦ä¸€æ¬¡",
                    correct: "ç­”å°äº†ï¼",
                    incorrect: "ç­”éŒ¯äº†ã€‚",
                    flipTip: "(é»žæ“Šç¿»è½‰ï¼Œé»žæ“Šä»–è™•é‚„åŽŸ)",
                    footerLeft: `v3.4 | ${new Date().toISOString().split('T')[0]} | Â© Thinking Upgrader`,
                    footerRight: "æŒ‡å°Žæ•™æŽˆï¼šProf. Shihmin Lo"
                }
            }
        };

        const tsmcData_zh = {
            o: "1. è²¡å ±é¡¯ç¤ºç¾Žåœ‹å» æˆæœ¬é«˜4å€ã€‚ 2. å·¥æœƒæŠ—è­°å¼•é€²å°å‹žã€‚ 3. Glassdoor å‡ºç¾å·¥ç¨‹å¸«æŠ±æ€¨è»äº‹åŒ–ç®¡ç†ã€‚",
            r: "è¦ºå¾—æ··äº‚èˆ‡æ“”æ†‚ï¼Œæ“”å¿ƒæ–‡åŒ–è¡çªå°Žè‡´å»ºå» å¤±æ•—ã€‚",
            i: "ä¸åªæ˜¯æŠ€è¡“å•é¡Œï¼Œæ›´æ˜¯æ·±å±¤çš„ã€Œå·¥ä½œæ–‡åŒ–ã€èˆ‡ã€Œç®¡ç†åˆ¶åº¦ã€è¡çªã€‚",
            d: "å»ºè­°ç ”ç©¶é‡é»žæ”¾åœ¨ã€Œè·¨æ–‡åŒ–ç®¡ç†ã€èˆ‡ã€Œåœ¨åœ°åŒ–ç­–ç•¥ã€çš„èª¿æ•´ã€‚",
            logic: "æº¯å› ï¼šé€²åº¦è½å¾Œå¯èƒ½æ˜¯å› ç‚ºã€Œå°ç£è²¬ä»»åˆ¶ã€åœ¨ç¾Žåœ‹æ°´åœŸä¸æœã€‚æ­¸ç´ï¼šæ¯”è¼ƒç¾Žæ—¥è¨­å» å·®ç•°ï¼Œç™¼ç¾ã€Œæ–‡åŒ–è·é›¢ã€æ˜¯é—œéµè®Šæ•¸ã€‚",
            thesis: "å…¨çƒå¸ƒå±€æ´¾ï¼šå¿…é ˆåŽ»ç¾Žåœ‹ï¼ˆé¿éšªï¼‰ã€‚",
            anti: "æˆæœ¬æ•ˆçŽ‡æ´¾ï¼šä¸è©²åŽ»ç¾Žåœ‹ï¼ˆæˆæœ¬é«˜ã€ç„¡ä¾›æ‡‰éˆï¼‰ã€‚",
            synth: "é›™è»Œç­–ç•¥ï¼šç¾Žåœ‹å» å®šä½ç‚ºã€Œé«˜æº¢åƒ¹æœå‹™ä¸­å¿ƒã€ï¼ˆé¿éšªï¼‰ï¼Œå°ç£å» ä¿ç•™ç‚ºã€Œé«˜æ•ˆçŽ‡é‡ç”¢åŸºåœ°ã€ã€‚",
            model: "X(è·¨æ–‡åŒ–é©æ‡‰) -> Me(çµ„ç¹”èªåŒ) -> Y(ç‡Ÿé‹ç¸¾æ•ˆ)ï¼›Mo(åœ°ç·£æ”¿æ²»å£“åŠ›)",
            verify: "è³ªæ€§ç ”ç©¶ã€‚è¨ªè«‡æ´¾é§å·¥ç¨‹å¸«ï¼Œæ¯”è¼ƒæ··åˆç®¡ç†æ¨¡å¼èˆ‡å‚³çµ±æ¨¡å¼çš„éƒ¨é–€ç¸¾æ•ˆã€‚"
        };

        const tsmcData_en = {
            o: "1. Financial reports show US plant costs are 4x higher. 2. Union protests against importing Taiwanese labor. 3. Engineers complain about military-style management on Glassdoor.",
            r: "Feeling chaotic and worried. Concerned that cultural conflicts will lead to plant failure.",
            i: "It's not just technical issues, but deep conflicts in 'work culture' and 'management systems'.",
            d: "Recommend focusing research on 'cross-cultural management' and 'localization strategy' adjustments.",
            logic: "Abduction: Delays might be because 'Taiwanese responsibility system' doesn't fit the US. Induction: Comparing US/Japan plants, 'cultural distance' is the key variable.",
            thesis: "Global Expansion: Must go to the US (Risk hedging).",
            anti: "Cost Efficiency: Should not go to the US (High cost, no supply chain).",
            synth: "Dual-Track Strategy: US plant as 'High-Premium Service Center' (Hedging), Taiwan plant as 'High-Efficiency Mass Production Base'.",
            model: "X (Cross-cultural adaptation) -> Me (Org identity) -> Y (Operational performance); Mo (Geopolitical pressure)",
            verify: "Qualitative research. Interview seconded engineers, compare departmental performance between hybrid and traditional management models."
        };

        const tsmcData = {
            zh: tsmcData_zh,
            en: tsmcData_en
        };

        // --- Shared Components ---

        const Toast = ({ message, onClose }) => {
            useEffect(() => {
                const timer = setTimeout(onClose, 3000);
                return () => clearTimeout(timer);
            }, [onClose]);

            return (
                <div className="fixed bottom-12 right-4 z-50 bg-bcg-green dark:bg-bcg-gold text-white dark:text-bcg-dark px-6 py-3 rounded-lg shadow-xl flex items-center toast-enter">
                    <Icons.CheckCircle className="mr-2" size={20} />
                    <span className="font-bold">{message}</span>
                </div>
            );
        };

        const FlipCard = ({ term, def, tip }) => {
            const [flipped, setFlipped] = useState(false);
            const cardRef = useRef(null);

            useEffect(() => {
                const handleClickOutside = (event) => {
                    if (cardRef.current && !cardRef.current.contains(event.target) && flipped) {
                        setFlipped(false);
                    }
                };

                document.addEventListener('mousedown', handleClickOutside);
                return () => {
                    document.removeEventListener('mousedown', handleClickOutside);
                };
            }, [flipped]);

            return (
                <div ref={cardRef} className="group h-48 w-full cursor-pointer perspective-1000" onClick={() => setFlipped(!flipped)}>
                    <div className={`relative h-full w-full transition-transform duration-500 transform-style-3d ${flipped ? 'rotate-y-180' : ''}`}>
                        <div className="absolute inset-0 h-full w-full rounded-xl bg-white dark:bg-bcg-card border border-bcg-light/20 p-6 flex flex-col items-center justify-center shadow-lg backface-hidden">
                            <h4 className="text-xl font-bold text-bcg-green dark:text-bcg-gold text-center mb-2 brand-font">{term}</h4>
                            <p className="text-xs text-gray-500 mt-2">{tip}</p>
                        </div>
                        <div className="absolute inset-0 h-full w-full rounded-xl bg-bcg-green border border-bcg-gold p-6 flex items-center justify-center shadow-lg rotate-y-180 backface-hidden">
                            <p className="text-sm text-gray-100 text-center leading-relaxed font-medium">{def}</p>
                        </div>
                    </div>
                </div>
            );
        };

        const Quiz = ({ questions, ui, onComplete, id, savedScore }) => {
            const [currentQ, setCurrentQ] = useState(0);
            const [status, setStatus] = useState('idle');
            const [score, setScore] = useState(0);
            const [finished, setFinished] = useState(false);

            useEffect(() => {
                if (savedScore) {
                    setFinished(true);
                    setScore(questions.length); 
                } else {
                    setCurrentQ(0); setStatus('idle'); setScore(0); setFinished(false);
                }
            }, [questions, savedScore]);

            const handleSelect = (idx) => {
                if (status === 'correct') return;
                const isCorrect = idx === questions[currentQ].ans;
                if (isCorrect) {
                    setStatus('correct');
                    setScore(s => s + 1);
                } else {
                    setStatus('incorrect');
                }
            };

            const nextQ = () => {
                if (currentQ < questions.length - 1) {
                    setCurrentQ(currentQ + 1);
                    setStatus('idle');
                } else {
                    setFinished(true);
                    onComplete(id, true);
                }
            };

            const retry = () => setStatus('idle');

            if (finished && savedScore) return (
                 <div className="p-6 bg-bcg-green/10 dark:bg-bcg-gold/10 rounded-lg text-center font-bold border border-bcg-green/20 dark:border-bcg-gold/20 animate-fade-in-up">
                    <div className="text-4xl mb-2">ðŸŽ‰</div>
                    <div className="text-bcg-green dark:text-bcg-gold">{ui.correct}</div>
                </div>
            );

            if (finished) return <div className="p-6 bg-bcg-green/20 rounded-lg text-center font-bold animate-fade-in-up">Quiz Completed! Score: {score}/{questions.length}</div>;

            const q = questions[currentQ];

            return (
                <div className="mt-6 bg-gray-100 dark:bg-bcg-dark/50 p-6 rounded-lg border border-gray-200 dark:border-gray-700 animate-fade-in-up">
                    <h5 className="text-lg font-bold text-gray-800 dark:text-gray-200 mb-4 flex items-center">
                        <Icons.Brain className="mr-2 text-bcg-green dark:text-bcg-gold" /> Quiz {currentQ + 1}/{questions.length}
                    </h5>
                    <p className="text-gray-700 dark:text-gray-300 mb-4 font-medium">{q.q}</p>
                    <div className="space-y-2">
                        {q.opts.map((opt, idx) => {
                            let style = "w-full text-left p-3 rounded border transition-all duration-200 ";
                            if (status === 'idle') style += "border-gray-300 dark:border-gray-600 hover:bg-gray-200 dark:hover:bg-gray-700";
                            else if (status === 'correct' && idx === q.ans) style += "bg-green-100 dark:bg-green-900/40 border-green-500 text-green-800 dark:text-green-100";
                            else if (status === 'incorrect' && idx !== q.ans) style += "opacity-50 border-gray-300 dark:border-gray-700";
                            else if (status === 'incorrect' && idx === q.ans) style += "opacity-50 border-gray-300 dark:border-gray-700";
                            
                            if (status === 'incorrect' && idx !== q.ans && document.activeElement.innerText === opt) {
                                style = "w-full text-left p-3 rounded border bg-red-100 dark:bg-red-900/40 border-red-500 text-red-800 dark:text-red-100";
                            }

                            return <button key={idx} onClick={() => handleSelect(idx)} className={style} disabled={status === 'correct'}>{opt}</button>;
                        })}
                    </div>
                    {status !== 'idle' && (
                        <div className={`mt-4 p-4 rounded ${status === 'correct' ? 'bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-600' : 'bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-600'} animate-fade-in-up`}>
                            <div className="flex items-center mb-2 font-bold">
                                {status === 'correct' ? <span className="text-green-600 dark:text-green-400 flex items-center"><Icons.CheckCircle className="mr-2"/> {ui.correct}</span> : <span className="text-red-600 dark:text-red-400 flex items-center"><Icons.XCircle className="mr-2"/> {ui.incorrect}</span>}
                            </div>
                            <p className="text-sm text-gray-700 dark:text-gray-300">{q.exp}</p>
                            <div className="mt-4 flex gap-2">
                                {status === 'incorrect' && <button onClick={retry} className="px-3 py-1 text-xs rounded border border-bcg-green dark:border-bcg-gold text-bcg-green dark:text-bcg-gold hover:bg-bcg-green/10">{ui.tryAgain}</button>}
                                {status === 'correct' && <button onClick={nextQ} className="px-3 py-1 text-xs rounded bg-bcg-green dark:bg-bcg-gold text-white dark:text-bcg-dark font-bold">Next</button>}
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const TextToSpeech = ({ text, lang }) => {
            const [speaking, setSpeaking] = useState(false);
            const speak = () => {
                if (window.speechSynthesis.speaking) { window.speechSynthesis.cancel(); setSpeaking(false); return; }
                const u = new SpeechSynthesisUtterance(text);
                const vs = window.speechSynthesis.getVoices();
                let v = null;
                
                // Enhanced voice selection logic
                if (lang === 'en') {
                    // Try to find British Male specifically if possible, else generic EN
                    v = vs.find(x => x.name.includes('Google UK English Male')) ||
                        vs.find(x => x.name.includes('Great Britain') && x.name.includes('Male')) ||
                        vs.find(x => x.lang === 'en-GB') ||
                        vs.find(x => x.lang.startsWith('en'));
                } else {
                    // Try to find TW specific, Yating, or generic ZH
                    v = vs.find(x => x.name.includes('Yating') || x.name.includes('é›…å©·')) ||
                        vs.find(x => x.name.includes('Google åœ‹èªž') && x.lang === 'zh-TW') ||
                        vs.find(x => x.lang === 'zh-TW') ||
                        vs.find(x => x.lang.startsWith('zh'));
                }
                
                if (v) u.voice = v;
                u.onend = () => setSpeaking(false);
                setSpeaking(true);
                window.speechSynthesis.speak(u);
            };
            return (
                <button onClick={speak} className={`ml-3 p-2 rounded-full transition-all ${speaking ? 'bg-bcg-gold text-bcg-dark animate-pulse' : 'bg-bcg-light text-white hover:bg-bcg-gold hover:text-bcg-dark'}`} title="TTS">
                    <Icons.Volume2 size={16} />
                </button>
            );
        };

        // --- Main Views ---

        const IntroView = ({ content, onNavigate }) => (
            <div className="max-w-4xl mx-auto space-y-12 py-10 animate-fade-in-up">
                <div className="text-center space-y-6">
                    <h1 className="text-4xl md:text-6xl font-bold brand-font text-bcg-green dark:text-white">{content.title}</h1>
                    <p className="text-xl text-gray-600 dark:text-bcg-gold font-serif italic">{content.subtitle}</p>
                    <p className="text-lg text-gray-700 dark:text-gray-300 max-w-2xl mx-auto leading-relaxed">{content.desc}</p>
                </div>
                
                {/* 5-Step Map */}
                <div className="bg-white dark:bg-bcg-card p-8 rounded-xl shadow-lg border-t-4 border-bcg-gold">
                    <h3 className="text-2xl font-bold text-center mb-8 text-gray-800 dark:text-white brand-font">{content.mapTitle}</h3>
                    <div className="space-y-4">
                        {content.steps.map(s => (
                            <div 
                                key={s.id} 
                                onClick={() => onNavigate(s.target)}
                                className="flex items-center p-4 bg-gray-50 dark:bg-bcg-dark rounded-lg border border-gray-200 dark:border-gray-700 hover:border-bcg-gold hover:bg-bcg-green/5 cursor-pointer transition-all transform hover:-translate-y-1"
                            >
                                <div className="w-10 h-10 rounded-full bg-bcg-green text-bcg-gold flex items-center justify-center font-bold text-lg mr-4 shadow">{s.id}</div>
                                <span className="text-lg font-medium text-gray-800 dark:text-gray-200">{s.text}</span>
                            </div>
                        ))}
                    </div>
                </div>

                {/* Video Resources */}
                {content.videos && (
                    <div className="bg-white dark:bg-bcg-card p-8 rounded-xl shadow-lg border-t-4 border-bcg-green">
                        <h3 className="text-xl font-bold text-center mb-6 text-gray-800 dark:text-white brand-font">{content.videoTitle || "Recommended Videos"}</h3>
                         <div className="grid gap-4 md:grid-cols-2">
                            {content.videos.map((v, i) => (
                                <a key={i} href={v.url} target="_blank" rel="noreferrer" className="flex items-center p-4 bg-gray-50 dark:bg-bcg-dark rounded-lg border border-gray-200 dark:border-gray-700 hover:border-bcg-green dark:hover:border-bcg-gold transition-all group">
                                    <div className="p-3 bg-red-600 text-white rounded-full mr-4 shadow-md group-hover:scale-110 transition-transform flex-shrink-0">
                                         <Icons.Video size={20} />
                                    </div>
                                    <div>
                                        <div className="font-bold text-sm text-gray-800 dark:text-white group-hover:text-bcg-green dark:group-hover:text-bcg-gold transition-colors">{v.title}</div>
                                    </div>
                                </a>
                            ))}
                         </div>
                    </div>
                )}
            </div>
        );

        const ChapterView = ({ ch, ui, onQuizComplete, isCompleted, lang }) => (
            <div className="max-w-6xl mx-auto py-6 animate-fade-in-up">
                <div className="mb-8 pb-6 border-b border-gray-200 dark:border-gray-700">
                    <div className="flex items-center space-x-4 mb-2">
                        <div className="p-3 bg-bcg-green text-bcg-gold rounded-full shadow-lg"><ch.icon size={32}/></div>
                        <h2 className="text-3xl md:text-4xl font-bold text-gray-900 dark:text-white brand-font">{ch.title}</h2>
                    </div>
                    <h3 className="text-xl text-bcg-light dark:text-bcg-gold ml-16">{ch.subtitle}</h3>
                </div>

                <div className="grid lg:grid-cols-12 gap-8">
                    <div className="lg:col-span-7 space-y-8">
                        <div className="bg-white dark:bg-bcg-card p-6 rounded-lg border-l-4 border-bcg-gold shadow-md">
                            <div className="flex items-center justify-between mb-4">
                                <h4 className="text-lg font-bold text-gray-800 dark:text-gray-200 uppercase tracking-wider flex items-center">
                                    <Icons.Brain className="mr-2 text-bcg-green dark:text-bcg-gold" size={20}/> CORE CONCEPT
                                </h4>
                                <TextToSpeech text={ch.coreConcept} lang={lang} />
                            </div>
                            <p className="text-gray-700 dark:text-gray-300 leading-relaxed text-justify text-lg">{ch.coreConcept}</p>
                        </div>
                        <div>
                            <h4 className="text-lg font-bold text-gray-800 dark:text-gray-200 mb-4 flex items-center">
                                <Icons.Search className="mr-2 text-bcg-green dark:text-bcg-gold" size={20}/> KEY TERMS
                            </h4>
                            <div className="grid md:grid-cols-2 gap-4">
                                {ch.glossary.map((g, i) => <FlipCard key={i} term={g.term} def={g.def} tip={ui.flipTip} />)}
                            </div>
                        </div>
                    </div>
                    <div className="lg:col-span-5">
                        <div className="bg-white dark:bg-bcg-card rounded-xl shadow-md border border-gray-200 dark:border-gray-700 h-full p-6">
                            <h4 className="text-lg font-bold text-bcg-green dark:text-bcg-gold mb-6 flex items-center brand-font border-b border-gray-200 dark:border-gray-700 pb-2">
                                <Icons.FlaskConical className="mr-2"/> CASE STUDY
                            </h4>
                            <h5 className="font-bold text-gray-900 dark:text-white mb-2 text-lg">{ch.caseStudy.title}</h5>
                            <p className="text-gray-600 dark:text-gray-400 leading-relaxed mb-6">{ch.caseStudy.desc}</p>
                            <Quiz questions={ch.caseStudy.quiz} ui={ui} onComplete={onQuizComplete} id={ch.id} savedScore={isCompleted} />
                        </div>
                    </div>
                </div>
            </div>
        );

        const WorksheetView = ({ data, isBlank, labels, onSave }) => {
            const [inputs, setInputs] = useState(data || {});

            useEffect(() => {
                setInputs(data || {});
            }, [data]);
            
            const handleChange = (k, v) => setInputs({...inputs, [k]: v});
            const handleSave = () => onSave(inputs);
            
            return (
                <div className="max-w-4xl mx-auto py-10 animate-fade-in-up space-y-8">
                    <div className="flex justify-between items-center mb-8">
                        <h2 className="text-3xl font-bold brand-font text-gray-900 dark:text-white">{isBlank ? labels.blankTitle : labels.exTitle}</h2>
                        {isBlank && (
                            <button 
                                className="bg-bcg-gold text-bcg-dark px-6 py-2 rounded-full font-bold shadow-lg hover:bg-yellow-400 hover:scale-105 transition-all flex items-center" 
                                onClick={handleSave}
                            >
                                <Icons.Save className="mr-2" size={18}/> {labels.save}
                            </button>
                        )}
                    </div>

                    {[
                        {title: labels.s1, keys: ['o','r','i','d']},
                        {title: labels.s2, keys: ['logic','thesis','anti','synth']},
                        {title: labels.s3, keys: ['model','verify']}
                    ].map((sec, i) => (
                        <div key={i} className="bg-white dark:bg-bcg-card p-8 rounded-xl shadow-lg border-t-4 border-bcg-green">
                            <h3 className="text-xl font-bold mb-6 text-bcg-green dark:text-bcg-gold">{sec.title}</h3>
                            <div className="space-y-4">
                                {sec.keys.map(k => (
                                    <div key={k}>
                                        <label className="block text-xs font-bold text-gray-500 uppercase tracking-wider mb-1">{labels.labels[k] || k.toUpperCase()}</label>
                                        {isBlank ? (
                                            <textarea 
                                                className="w-full p-3 rounded border border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-bcg-dark text-gray-900 dark:text-white focus:ring-2 focus:ring-bcg-gold outline-none transition-all" 
                                                rows="3"
                                                value={inputs[k]||''}
                                                onChange={(e)=>handleChange(k, e.target.value)}
                                                placeholder="..."
                                            />
                                        ) : (
                                            <div className="p-4 bg-gray-50 dark:bg-bcg-dark/50 rounded border border-gray-100 dark:border-gray-700 text-gray-700 dark:text-gray-300 font-serif leading-relaxed">
                                                {inputs[k]}
                                            </div>
                                        )}
                                    </div>
                                ))}
                            </div>
                        </div>
                    ))}
                </div>
            );
        };

        const Dashboard = ({ scores, savedWorksheet, c }) => {
            const completedCount = Object.values(scores).filter(v => v).length;
            const progress = Math.round((completedCount / 5) * 100);

            const handleExport = () => {
                const header = ["Type", "Key", "Content"];
                const rows = [];
                
                // Add Scores
                rows.push(["Progress", "Overall", `${progress}%`]);
                ['ch1','ch2','ch3','ch4','ch5'].forEach(k => {
                    rows.push(["Quiz Completion", k, scores[k] ? "Completed" : "Pending"]);
                });

                // Add Worksheet
                if (savedWorksheet) {
                    Object.entries(savedWorksheet).forEach(([k, v]) => {
                        // Escape quotes
                        const safeVal = v ? `"${v.replace(/"/g, '""')}"` : "";
                        rows.push(["Worksheet", k, safeVal]);
                    });
                }

                const csvContent = "data:text/csv;charset=utf-8," 
                    + [header.join(','), ...rows.map(e => e.join(','))].join('\n');

                const encodedUri = encodeURI(csvContent);
                const link = document.createElement("a");
                link.setAttribute("href", encodedUri);
                link.setAttribute("download", "TU_Learning_Record.csv");
                document.body.appendChild(link);
                link.click();
            };
            
            return (
                <div className="max-w-4xl mx-auto py-10 animate-fade-in-up">
                    <div className="flex justify-between items-center mb-10">
                        <h2 className="text-3xl font-bold brand-font text-gray-900 dark:text-white">{c.title}</h2>
                        <button onClick={handleExport} className="bg-bcg-green text-white px-4 py-2 rounded shadow hover:bg-bcg-light flex items-center">
                            <Icons.Download className="mr-2" size={16}/> {c.export}
                        </button>
                    </div>

                    <div className="grid md:grid-cols-3 gap-8">
                        <div className="bg-white dark:bg-bcg-card p-8 rounded-xl shadow-md flex flex-col items-center justify-center text-center col-span-1 border border-gray-200 dark:border-gray-700">
                            <div className="relative w-32 h-32 mb-4 flex items-center justify-center">
                                <svg className="w-full h-full transform -rotate-90">
                                    <circle cx="64" cy="64" r="56" stroke="currentColor" strokeWidth="8" fill="transparent" className="text-gray-200 dark:text-gray-700" />
                                    <circle cx="64" cy="64" r="56" stroke="currentColor" strokeWidth="8" fill="transparent" className="text-bcg-gold transition-all duration-1000 ease-out" strokeDasharray={351} strokeDashoffset={351 - (351 * progress) / 100} />
                                </svg>
                                <span className="absolute text-2xl font-bold text-gray-800 dark:text-white">{progress}%</span>
                            </div>
                            <h3 className="font-bold text-gray-600 dark:text-gray-400">{c.progress}</h3>
                        </div>
                        <div className="bg-white dark:bg-bcg-card p-8 rounded-xl shadow-md col-span-2 border border-gray-200 dark:border-gray-700">
                            <h3 className="font-bold text-gray-800 dark:text-white mb-6 flex items-center"><Icons.LayoutDashboard className="mr-2"/> {c.badges}</h3>
                            <div className="grid grid-cols-2 sm:grid-cols-3 gap-4">
                                {c.badgeList.map((b, i) => (
                                    <div key={i} className={`p-3 rounded border text-center transition-all ${scores[`ch${i+1}`] ? 'bg-bcg-green/10 border-bcg-gold text-bcg-green dark:text-bcg-gold shadow-md transform scale-105' : 'bg-gray-50 dark:bg-bcg-dark border-gray-200 dark:border-gray-700 text-gray-400 opacity-50 grayscale'}`}>
                                        <div className="text-2xl mb-1">{scores[`ch${i+1}`] ? 'ðŸ†' : 'ðŸ”’'}</div>
                                        <div className="text-xs font-bold">{b}</div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [lang, setLang] = useState('en');
            const [theme, setTheme] = useState('dark');
            const [view, setView] = useState('intro');
            const [menuOpen, setMenuOpen] = useState(false);
            const [scores, setScores] = useState({});
            const [savedWorksheet, setSavedWorksheet] = useState({});
            const [toast, setToast] = useState(null);

            const c = content[lang];
            const currentTsmcData = tsmcData[lang];

            // Load data from localStorage on mount
            useEffect(() => {
                const storedScores = localStorage.getItem('tu_scores');
                if (storedScores) setScores(JSON.parse(storedScores));

                const storedWs = localStorage.getItem('tu_worksheet');
                if (storedWs) setSavedWorksheet(JSON.parse(storedWs));
            }, []);

            useEffect(() => {
                if (theme === 'dark') document.documentElement.classList.add('dark');
                else document.documentElement.classList.remove('dark');
            }, [theme]);

            const handleQuizComplete = (id, success) => {
                if (success) {
                    const newScores = {...scores, [id]: true};
                    setScores(newScores);
                    localStorage.setItem('tu_scores', JSON.stringify(newScores));
                    showToast("Quiz Complete! Progress Saved.");
                }
            };

            const handleSaveWorksheet = (data) => {
                setSavedWorksheet(data);
                localStorage.setItem('tu_worksheet', JSON.stringify(data));
                showToast(c.worksheets.saved);
            };

            const showToast = (msg) => {
                setToast(msg);
            };

            const switchView = (id) => {
                setView(id);
                setMenuOpen(false);
                // Force scroll main content to top
                const mainContent = document.getElementById('main-content');
                if (mainContent) mainContent.scrollTop = 0;
            };

            const NavItem = ({ id, label, icon: IconComp }) => (
                <button 
                    onClick={() => switchView(id)} 
                    className={`flex items-center w-full text-left px-6 py-3 font-bold brand-font transition-colors ${view === id ? 'text-bcg-green dark:text-bcg-gold bg-gray-100 dark:bg-white/5 border-l-4 border-bcg-green dark:border-bcg-gold' : 'text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white'}`}
                >
                    {IconComp && <IconComp size={18} className="mr-3 opacity-70"/>}
                    {label}
                </button>
            );

            // Icon Mapping for Menu
            const chapterIcons = [Icons.Target, Icons.GitBranch, Icons.Search, Icons.Brain, Icons.FlaskConical];

            return (
                <div className="flex flex-col h-screen">
                    {toast && <Toast message={toast} onClose={() => setToast(null)} />}
                    
                    {/* Header */}
                    <header className="fixed top-0 w-full z-50 bg-white/95 dark:bg-bcg-dark/95 backdrop-blur shadow border-b border-gray-200 dark:border-gray-800 h-16 flex items-center px-4 lg:px-8 justify-between">
                        <div className="flex items-center">
                            <button onClick={() => setMenuOpen(!menuOpen)} className="p-2 mr-4 rounded hover:bg-gray-100 dark:hover:bg-white/10 text-gray-700 dark:text-white transition-colors lg:hidden">
                                {menuOpen ? <Icons.X /> : <Icons.Menu />}
                            </button>
                            <div className="cursor-pointer" onClick={() => switchView('intro')}>
                                <h1 className="text-xl font-bold brand-font text-bcg-green dark:text-white tracking-wide hover:text-bcg-gold transition-colors">{c.brand}</h1>
                            </div>
                        </div>
                        <div className="flex items-center space-x-3">
                            <button onClick={() => setLang(lang === 'en' ? 'zh' : 'en')} className="flex items-center px-3 py-1 rounded border border-gray-300 dark:border-gray-600 text-xs font-bold text-gray-600 dark:text-gray-300 hover:border-bcg-gold hover:text-bcg-green dark:hover:text-bcg-gold transition-all">
                                <Icons.Globe size={14} className="mr-1"/> {lang === 'en' ? 'ç¹ä¸­' : 'ENG'}
                            </button>
                            <button onClick={() => setTheme(theme === 'dark' ? 'light' : 'dark')} className="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-white/10 text-gray-600 dark:text-bcg-gold transition-colors">
                                {theme === 'dark' ? <Icons.Sun size={20}/> : <Icons.Moon size={20}/>}
                            </button>
                        </div>
                    </header>

                    {/* Mobile Menu Overlay */}
                    {menuOpen && <div className="fixed inset-0 bg-black/50 z-40 lg:hidden" onClick={() => setMenuOpen(false)} />}
                    
                    {/* Main Container */}
                    <div className="flex flex-1 pt-16 h-full overflow-hidden">
                        
                        {/* Sidebar */}
                        <aside className={`fixed lg:static inset-y-0 left-0 w-64 bg-white dark:bg-bcg-card border-r border-gray-200 dark:border-gray-800 z-50 transform transition-transform duration-300 ease-in-out lg:transform-none ${menuOpen ? 'translate-x-0' : '-translate-x-full'}`}>
                            <div className="h-full overflow-y-auto py-6 space-y-1 pb-20">
                                <NavItem id="intro" label={c.nav.intro} icon={Icons.Home} />
                                <div className="px-6 py-2 text-xs font-bold text-gray-400 uppercase tracking-wider mt-4">Chapters</div>
                                {['ch1','ch2','ch3','ch4','ch5'].map((id, idx) => <NavItem key={id} id={id} label={c.nav[id]} icon={chapterIcons[idx]} />)}
                                <div className="px-6 py-2 text-xs font-bold text-gray-400 uppercase tracking-wider mt-4">Tools</div>
                                <NavItem id="ws_ex" label={c.nav.ws_ex} icon={Icons.FileText} />
                                <NavItem id="ws_blank" label={c.nav.ws_blank} icon={Icons.FileText} />
                                <NavItem id="dash" label={c.nav.dashboard} icon={Icons.LayoutDashboard} />
                            </div>
                        </aside>

                        {/* Content Area */}
                        <main className="flex-1 w-full relative overflow-y-auto bg-bcg-gray dark:bg-bcg-dark pb-10" id="main-content">
                            <div className="px-4 md:px-8 py-8 min-h-[calc(100vh-6rem)]">
                                {view === 'intro' && <IntroView content={c.intro} onNavigate={switchView} />}
                                {view.startsWith('ch') && <ChapterView ch={c.chapters.find(x => x.id === view)} ui={c.ui} onQuizComplete={handleQuizComplete} isCompleted={scores[view]} lang={lang} />}
                                {view === 'ws_ex' && <WorksheetView data={currentTsmcData} isBlank={false} labels={c.worksheets} />}
                                {view === 'ws_blank' && <WorksheetView data={savedWorksheet} isBlank={true} labels={c.worksheets} onSave={handleSaveWorksheet} />}
                                {view === 'dash' && <Dashboard scores={scores} savedWorksheet={savedWorksheet} c={c.dashboard} />}
                            </div>
                        </main>
                    </div>

                    {/* Footer - Fixed Bottom */}
                    <footer className="fixed bottom-0 w-full bg-white dark:bg-bcg-dark border-t border-gray-200 dark:border-gray-800 h-8 flex items-center justify-between px-4 lg:px-8 text-[10px] md:text-xs text-gray-500 z-50">
                        <div>{c.ui.footerLeft}</div>
                        <div>{c.ui.footerRight} <a href="https://www.ibs.ncnu.edu.tw/index.php/faculty/tenured-professor/299-smlo" target="_blank" className="text-bcg-green dark:text-bcg-gold hover:underline ml-1"><Icons.ExternalLink size={10} className="inline"/></a></div>
                    </footer>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>